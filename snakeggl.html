<!DOCTYPE html>
<html>
	<head>
		<meta charset="gbk">
		<title>贪吃蛇-刮刮乐</title>
		<style type="text/css">
			#pannelBack{width:960px; height:1280px; }
		</style>		
	</head>
	<body onload="init()">
		<div style="position:relative;">
			<img id="pannelBack" src="" style="opacity:1;" >
			<canvas id="myCanvas" width="960px" height="1280px" style="position:absolute;left:0px;top:0px;"></canvas>
			<div id="divStart"></div> 
			<div id="divMove"></div>
			<div id="divEnd"></div>
		</div>	
	</body>
	<script type="text/javascript">
			//页面元素，图片加载
			var c=document.getElementById("myCanvas");
			var ctx=c.getContext("2d");
			var snake=[{x:2,y:0},{x:1,y:0},{x:0,y:0}];
			var LEFT=37;
			var RIGHT=39;
			var UP=38;
			var DOWN=40;
			var direction=RIGHT;
			var loopMove;
			function init(){
				ctx.fillStyle="#FFF";
				ctx.fillRect(0,0,960,1280);
				
				for(var i=0;i<13;i++){
					ctx.moveTo(80*i,0);
					ctx.lineTo(80*i,1280);
					ctx.stroke();
				}
				for(var i=0;i<17;i++){
					ctx.moveTo(0,80*i);
					ctx.lineTo(960,80*i);
					ctx.stroke();
				}		
				var picture="ggl_"+(makeRandom(1)+1)+".jpg";
				document.getElementById("pannelBack").src=picture;
				paint(snake);
				loopMove=window.setInterval(move,500);
			}
			function move(){				
				switch(direction){
					case LEFT :
						if(snake[0].x - 1 < 0){
							gameover();
							return;
						}					
						snake.unshift({x:snake[0].x-1,y:snake[0].y});
						break;
					case RIGHT :
						if(snake[0].x + 1 >= 12){
							gameover();
							return;
						}
						snake.unshift({x:snake[0].x+1,y:snake[0].y});
						break;
					case UP	:
						if(snake[0].y - 1 < 0){
							gameover();
							return;
						}
						snake.unshift({x:snake[0].x,y:snake[0].y-1});
						break;	
					case DOWN	:
						if(snake[0].y + 1 >= 16){
							gameover();
							return;
						}
						snake.unshift({x:snake[0].x,y:snake[0].y+1});
						break;
					}
				var tail=snake.pop();
				ctx.clearRect(tail.x*80,tail.y*80,80,80 );
				paint(snake);
			}			
			function paint(snake){
				ctx.fillStyle='#00F';
				for(var i=0;i<snake.length;i++){
					ctx.fillRect(snake[i].x*80,snake[i].y*80,80,80);
				}				
			}
			function gameover(){
				//alert("游戏结束");
				setTimeout(function(){alert("游戏结束")},0);
				window.clearInterval(loopMove);
			}		
			//手指放到屏幕上时,触摸点相对浏览器窗口的位置
			var startX=0;
			var startY=0;
			var endX=0;
			var endY=0;
			//手指放到屏幕上时触发
			function startT(ev){
				startX=ev.touches[0].clientX;
				startY=ev.touches[0].clientY;
				//divStart.innerHTML='Touch start('+ev.touches[0].clientX+', '+ev.touches[0].clientY+')';
				ev.preventDefault();  //阻止出现滚动条 
			}
			//手指离开屏幕时触发
			function endT(ev){
				//alert("touchend");
				endX=ev.changedTouches[0].clientX;
				endY=ev.changedTouches[0].clientY;						
				//divEnd.innerHTML='Touch end('+ev.changedTouches[0].clientX+', '+ev.changedTouches[0].clientY+')'; 
				doAction();
			}
			function doAction(){
				if(startX > endX && (startX-endX) > Math.abs(startY-endY)){
					direction=LEFT;
				}
				if(startY > endY && (startY-endY) > Math.abs(startX-endX)){
					direction=UP;
				}
				if(startX < endX && (endX-startX) > Math.abs(startY-endY)){
					direction=RIGHT;
				}
				if(startY < endY && (endY-startY) > Math.abs(startX-endX)){
					direction=DOWN;
				}	
			}						
			//绑定监听事件
			document.addEventListener('touchstart',startT,false); 
			document.addEventListener('touchend',endT,false); 
			//document.addEventListener('touchmove',moveT,false); 
			function makeRandom(n){
				return parseInt(n*Math.random());
			}
		</script>
</html>
